<div id="fiscal-code-calculator">
    <div class="cdf-form-control">
        <label class="block-label">Nome <input class="form-control name" type="text"/></label>
    </div>

    <div class="cdf-form-control">
        <label class="block-label">Cognome <input class="form-control lastname" type="text"/></label>
    </div>

    <div class="cdf-form-control">
        <label class="block-label">
            Comune
            <select>
                <option>-</option>
                <?php foreach ($this->getCommons() as $common) : ?>
                    <option value="<?php echo $common; ?>"><?php echo $common; ?></option>
                <?php endforeach; ?>
            </select>
        </label>
    </div>

    <div class="cdf-form-control">
        <label class="block-label">Nascita</label>
        <label class="">
            Giorno
            <select>
                <option>-</option>
                <?php foreach (range(1, 31) as $day) : ?>
                    <option value="<?php echo $day; ?>"><?php echo $day; ?></option>
                <?php endforeach; ?>
            </select>
        </label>
        &nbsp;
        <label class="">
            Mese
            <select>
                <option>-</option>
                <?php foreach (range(1, 12) as $day) : ?>
                    <option value="<?php echo $day; ?>"><?php echo $day; ?></option>
                <?php endforeach; ?>
            </select>
        </label>
        &nbsp;
        <label class="">
            Anno
            <select>
                <option>-</option>
                <?php foreach (range(1900, date("Y")) as $day) : ?>
                    <option value="<?php echo $day; ?>"><?php echo $day; ?></option>
                <?php endforeach; ?>
            </select>
        </label>
    </div>

    <div class="cdf-form-control">
        <label class="block-label">
            Sesso
            <select class="form-control gender">
                <option value="M">M</option>
                <option value="F">F</option>
            </select>
        </label>
    </div>

    <button class="submit" type="button">Calcola</button>
</div>

<script>
    var $ccf = jQuery.noConflict();

    $ccf(document).ready(function () {

        var $form = $ccf("#fiscal-code-calculator");
        var $calculateTemplateUrl = "<?php echo $this->getCalculateUrl(); ?>";

        $form.find(".submit").on("click", function (e) {

            var $calculateUrl = $calculateTemplateUrl;
            $calculateUrl = $calculateUrl.replace(/{name}/g, $form.find(".name").val());
            $calculateUrl = $calculateUrl.replace(/{lastname}/g, $form.find(".lastname").val());
            $calculateUrl = $calculateUrl.replace(/{common}/g, $form.find(".common").val());
            $calculateUrl = $calculateUrl.replace(/{birthday}/g,
                [
                    $form.find(".day").val(),
                    $form.find(".month").val(),
                    $form.find(".year").val()
                ].join('/')
            );
            $calculateUrl = $calculateUrl.replace(/{gender}/g, $form.find(".gender").val());

            console.log($calculateUrl);

            $ccf.ajax({
                url: $calculateUrl,
                method: 'get',
                success: function (response) {
                    var $code = new XMLSerializer().serializeToString(response).replace(/(<([^>]+)>)/ig, "");
                    alert($code);
                },
                error: function (response) {
                    alert("Errore");
                }
            });

            e.preventDefault();
        });
    });
</script>